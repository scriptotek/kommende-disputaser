{"version":3,"sources":["app.js"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["\nfunction stripHTML(dirtyString) {\n  var container = document.createElement('div');\n  var text = document.createTextNode(dirtyString);\n  container.appendChild(text);\n  return container.innerHTML; // innerHTML will be a xss safe string\n}\n\nfunction loadFeed(url, $main) {\n\n  function getViewData(entry) {\n    // Extracts and transforms data from an RSS entry\n    var dt = new Date(entry['v:event-start']['#']);\n    var dtstr = dt.toLocaleDateString('nb-NO', {\n        day : 'numeric',\n        month : 'long',\n        year : 'numeric',\n    }) + ', ' + dt.toLocaleTimeString('nb-NO', {\n        hour : '2-digit',\n        minute : '2-digit',\n    });\n\n    var summary = entry['summary'].replace(/(<([^>]+)>)/ig,\"\").trim();\n\n    if (summary.indexOf(':') != -1) {\n      var summarysplit = [\n        summary.substr(0, summary.indexOf(':')).replace(/[\"\\s]+$/, '').replace(/^[\"\\s]+/, ''),\n        summary.substr(summary.indexOf(':') + 1).replace(/[\"\\s]+$/, '').replace(/^[\"\\s]+/, ''),\n      ];\n    } else {\n      var summarysplit = [summary, ''];\n    }\n\n    var titleWordCount = summarysplit[1].split(' ').length;\n    var titleClass = 'default';\n    if (titleWordCount > 30) { titleClass = 'wc30'; }\n    else if (titleWordCount > 20) { titleClass = 'wc20'; }\n\n    return {\n      image: entry['v:image']['#'],\n      person: entry['title'].replace(/D[a-z]+: /, ''),\n      location: entry['v:event-location']['#'],\n      time: dtstr,\n      intro: summarysplit[0],\n      title: summarysplit[1],\n      titleClass: titleClass,\n    };\n  }\n\n  feednami.load(url, res => {\n    const entries = res.feed.entries;\n\n    entries.forEach(entry => {\n      if(entry.title.indexOf('PR:') == -1 ){\n        var view = getViewData(entry);\n        console.log(view);\n        var tplFn = doT.template($('#entry_template').html());\n        var $entry = $(tplFn(view));\n        $main.append($entry);\n      }\n    });\n\n    if (entries.length) {\n      Show.start($('.entry'), $('#cardno'));\n    } else {\n      $('#cardno').html('');\n      var tplFn = doT.template($('#empty_template').html());\n      var $entry = $(tplFn());\n      $main.append($entry);\n    }\n\n  });\n};\n\n/* Navigation module */\nvar Show = (function () {\n\n  var my = {\n    $cards: null,\n    $status: null,\n  }, currentCard = -1, size = 0, timer;\n\n  function showCard(n) {\n    if (my.$status) {\n      my.$status.html((n + 1) + ' / ' + size);\n    }\n    currentCard = n;\n    for (var i = size - 1; i >= 0; i--) {\n      if (i == currentCard) {\n        $(my.$cards[i]).show();\n      } else {\n        $(my.$cards[i]).hide();\n      }\n    }\n  }\n\n  function nextCard() {\n    showCard(currentCard > size - 2 ? 0 : currentCard + 1);\n  }\n\n  function prevCard() {\n    showCard(currentCard == 0 ? size - 1 : currentCard - 1);\n  }\n\n  $(window).keydown(function (e) {\n    /**\n     * Arrow keys: navigate through the cards and stop the timer so we can debug stuff\n     * Space key: jump to next slide and resume the timer.\n     */\n    if (e.keyCode === 0 || e.keyCode === 32) {  // Space\n      e.preventDefault();\n      tick();\n    } else if (e.keyCode === 39 || e.keyCode === 40) {  // Down or right key\n      my.stop();\n      e.preventDefault();\n      nextCard();\n    } else if (e.keyCode === 37 || e.keyCode === 38) {  // Up or left key\n      my.stop();\n      e.preventDefault();\n      prevCard();\n    }\n  });\n\n  function tick() {\n    my.stop();\n    nextCard();\n    timer = setTimeout(tick, 8000);  // Wait 8 seconds\n  }\n\n  my.start = function($cards, $status) {\n    if ($cards) {\n      my.$cards = $cards;\n      size = my.$cards.length;\n    }\n    if ($status) {\n      my.$status = $status;\n    }\n    tick();\n  }\n\n  my.stop = function() {\n    if (timer) {\n      clearTimeout(timer);\n    }\n  }\n\n  return my;\n})();\n\n\n/* Reload the browser if the page is updated (on git pull) */\n(function watch() {\n\n  var prev = null, timer = null, interval = 5 * 60 * 1000;\n\n  function tick() {\n    $.ajax({\n      type: 'HEAD',\n      url: 'index.html'\n    }).done(function(message, text, jqXHR){\n      var current = jqXHR.getResponseHeader('Content-Length');\n      if (!prev) {\n        prev = current;\n      } else if (current > 0 && prev != current) {\n        timer.stop();\n        setTimeout(function() {\n            // Short break to be really sure that we don't reload while write is in progress\n            window.location.replace('./?ts=' + current);\n        }, 500);\n      }\n      timer = setTimeout(tick, interval);\n    }).fail(function() {\n      console.log('no network');\n      timer = setTimeout(tick, interval);\n    });\n  }\n\n  timer = setTimeout(tick, interval);\n})();\n\n/* Init */\nloadFeed('http://www.mn.uio.no/forskning/aktuelt/arrangementer/disputaser/?vrtx=feed&view=allupcoming', $('main'));\n"],"sourceRoot":"/source/"}