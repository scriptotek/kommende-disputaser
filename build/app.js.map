{"version":3,"sources":["app.js"],"names":["stripHTML","dirtyString","container","document","createElement","text","createTextNode","appendChild","innerHTML","loadFeed","url","$main","getViewData","entry","dt","Date","dtstr","toLocaleDateString","day","month","year","toLocaleTimeString","hour","minute","summary","replace","trim","indexOf","summarysplit","substr","titleWordCount","split","length","titleClass","image","undefined","location","person","time","intro","title","feednami","load","entries","res","feed","forEach","view","console","log","tplFn","doT","template","$","html","$entry","append","Show","start","my","$cards","$status","currentCard","size","timer","showCard","n","i","show","hide","nextCard","prevCard","window","keydown","e","keyCode","preventDefault","tick","stop","setTimeout","clearTimeout","watch","prev","interval","ajax","type","done","message","jqXHR","current","getResponseHeader","fail"],"mappings":"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","file":"app.js","sourcesContent":["\nfunction stripHTML(dirtyString) {\n  var container = document.createElement('div');\n  var text = document.createTextNode(dirtyString);\n  container.appendChild(text);\n  return container.innerHTML; // innerHTML will be a xss safe string\n}\n\nfunction loadFeed(url, $main) {\n\n  function getViewData(entry) {\n    // Extracts and transforms data from an RSS entry\n    var dt = new Date(entry['v:event-start']['#']);\n    var dtstr = dt.toLocaleDateString('nb-NO', {\n        day : 'numeric',\n        month : 'long',\n        year : 'numeric',\n    }) + ', ' + dt.toLocaleTimeString('nb-NO', {\n        hour : '2-digit',\n        minute : '2-digit',\n    });\n\n    var summary = entry['summary'].replace(/(<([^>]+)>)/ig,\"\").trim();\n\n    if (summary.indexOf(':') != -1) {\n      var summarysplit = [\n        summary.substr(0, summary.indexOf(':')).replace(/[\"\\s]+$/, '').replace(/^[\"\\s]+/, ''),\n        summary.substr(summary.indexOf(':') + 1).replace(/[\"\\s]+$/, '').replace(/^[\"\\s]+/, ''),\n      ];\n    } else {\n      var summarysplit = [summary, ''];\n    }\n\n    var titleWordCount = summarysplit[1].split(' ').length;\n    var titleClass = 'default';\n    if (titleWordCount > 30) { titleClass = 'wc30'; }\n    else if (titleWordCount > 20) { titleClass = 'wc20'; }\n\n    var image = null;\n    if (entry['v:image'] !== undefined && entry['v:image']['#'] !== undefined) {\n        image = entry['v:image']['#'];\n    }\n\n    var location = '(not announced yet)'\n    if (entry['v:event-location'] !== undefined && entry['v:event-location']['#'] !== undefined) {\n        location = entry['v:event-location']['#'];\n    }\n\n    return {\n      image: image,\n      person: entry['title'].replace(/D[a-z]+: /, ''),\n      location: location,\n      time: dtstr,\n      intro: summarysplit[0],\n      title: summarysplit[1],\n      titleClass: titleClass,\n    };\n  }\n\n  feednami.load(url, res => {\n    const entries = res.feed.entries;\n\n    entries.forEach(entry => {\n      if(entry.title.indexOf('PR:') == -1 ){\n        var view = getViewData(entry);\n        console.log(view);\n        var tplFn = doT.template($('#entry_template').html());\n        var $entry = $(tplFn(view));\n        $main.append($entry);\n      }\n    });\n\n    if (entries.length) {\n      Show.start($('.entry'), $('#cardno'));\n    } else {\n      $('#cardno').html('');\n      var tplFn = doT.template($('#empty_template').html());\n      var $entry = $(tplFn());\n      $main.append($entry);\n    }\n\n  });\n};\n\n/* Navigation module */\nvar Show = (function () {\n\n  var my = {\n    $cards: null,\n    $status: null,\n  }, currentCard = -1, size = 0, timer;\n\n  function showCard(n) {\n    if (my.$status) {\n      my.$status.html((n + 1) + ' / ' + size);\n    }\n    currentCard = n;\n    for (var i = size - 1; i >= 0; i--) {\n      if (i == currentCard) {\n        $(my.$cards[i]).show();\n      } else {\n        $(my.$cards[i]).hide();\n      }\n    }\n  }\n\n  function nextCard() {\n    showCard(currentCard > size - 2 ? 0 : currentCard + 1);\n  }\n\n  function prevCard() {\n    showCard(currentCard == 0 ? size - 1 : currentCard - 1);\n  }\n\n  $(window).keydown(function (e) {\n    /**\n     * Arrow keys: navigate through the cards and stop the timer so we can debug stuff\n     * Space key: jump to next slide and resume the timer.\n     */\n    if (e.keyCode === 0 || e.keyCode === 32) {  // Space\n      e.preventDefault();\n      tick();\n    } else if (e.keyCode === 39 || e.keyCode === 40) {  // Down or right key\n      my.stop();\n      e.preventDefault();\n      nextCard();\n    } else if (e.keyCode === 37 || e.keyCode === 38) {  // Up or left key\n      my.stop();\n      e.preventDefault();\n      prevCard();\n    }\n  });\n\n  function tick() {\n    my.stop();\n    nextCard();\n    timer = setTimeout(tick, 8000);  // Wait 8 seconds\n  }\n\n  my.start = function($cards, $status) {\n    if ($cards) {\n      my.$cards = $cards;\n      size = my.$cards.length;\n    }\n    if ($status) {\n      my.$status = $status;\n    }\n    tick();\n  }\n\n  my.stop = function() {\n    if (timer) {\n      clearTimeout(timer);\n    }\n  }\n\n  return my;\n})();\n\n\n/* Reload the browser if the page is updated (on git pull) */\n(function watch() {\n\n  var prev = null, timer = null, interval = 5 * 60 * 1000;\n\n  function tick() {\n    $.ajax({\n      type: 'HEAD',\n      url: 'index.html'\n    }).done(function(message, text, jqXHR){\n      var current = jqXHR.getResponseHeader('Content-Length');\n      if (!prev) {\n        prev = current;\n      } else if (current > 0 && prev != current) {\n        timer.stop();\n        setTimeout(function() {\n            // Short break to be really sure that we don't reload while write is in progress\n            window.location.replace('./?ts=' + current);\n        }, 500);\n      }\n      timer = setTimeout(tick, interval);\n    }).fail(function() {\n      console.log('no network');\n      timer = setTimeout(tick, interval);\n    });\n  }\n\n  timer = setTimeout(tick, interval);\n})();\n"]}