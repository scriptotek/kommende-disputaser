<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Kommende disputaser MN</title>
    <style>

      /* Base styles */

      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        background: white;
      }

      .container {
        font-family: Arial;
        color: #333;
        font-size: 1.8vw;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        width: 100%;
        height: 100%;
      }

      .background-image {
        position: fixed;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        opacity: 0.5;
        z-index: 0;
        /*
        background: url(mnfrontpage-bg-print-1.png);
        */
        -webkit-filter: grayscale(100%);
        /* background: red; */
      }



      /* Header bar */

      header {
        flex: 0 0 auto;
        display: flex;
        background: #000;
      }
      header > div {
        box-sizing: border-box;
        padding: 2.0vw 4vw 2.0vw 4vw;
      }
      header .logo {
        justify-content: space-around;
        display: flex;
        flex-direction: column;
        background: #000;
        flex: 0 1 54%;
      }
      header .header {
        text-align: left;
        flex: 1 1 46%;
      }
      header h1 {
        color: #fff;
        font-weight: normal;
        font-size: 140%;
        margin: 0;
        padding: 0;
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.4);
        width: 100%;
      }
      .logo img {
        display: block;
        max-width: 100%;
        max-height: 100%;
      }

      footer {
        background: black;
      }
      footer div {
        color: #fff;
        font-size: 100%;
        padding: 1vw 4vw;
        margin: 0;
        /*
        position: absolute;
        bottom: 0;
        */
        text-align: right;
      }

      /* Main area */

      main {
        display: flex;
        flex: 1 0 auto;
        flex-direction: column;
      }
      .entry {
        display: flex;
        flex: 1 0 auto;
        align-items: stretch;
      }
      .entry .leftCol, .entry .rightCol {
        box-sizing: border-box;
        padding: 3vw 4vw;
      }
      .entry .rightCol {
        padding-left: 0;
      }
      .entry .leftCol {
        flex: 0 0 38%;
        /*background: orange;*/
        /*background: #f2f2f2 ;*/
        display: flex;
        justify-content: center;
        align-items: stretch;
      }
      .leftCol div {
        flex: 1 0 auto;
        overflow: hidden;
      }
      .leftCol div {
        background-repeat: no-repeat;
        background-size: cover;
        background-position: top center;
        -webkit-filter: saturate(1) grayscale(100%);
        /*box-shadow: 1px 1px 6px #666;*/
        /*border: 10px solid #777;*/
        /*border-radius:2px;*/
      }

      .entry .rightCol {
        flex: 1 0 62%;
        display: flex;
        align-items: stretch;
        flex-direction: row;
      }

      .rightCol .inner {
        background: url(mnfrontpage-bg-print-13.png);
        background-size: 100%;
        background-position: bottom center;
        padding: 3vw 4vw;

        display: flex;
        justify-content: space-between;
        flex-direction: column;

      }

      .rightCol .inner > * {
        margin: 1.5vw 0;
      }

      .rightCol .inner h2 {
        font-weight: normal;
        font-size: 150%;
        color: red;
        padding: 0;
        margin: 0;
        margin-bottom: 3vw;
      }

      .timeloc {
        flex: 0 0 auto;
        margin-bottom: 0 !important;
        /*border-top: 1px solid #dddddd;*/

      }
      .timeloc > * {
      }

      .summary {
        font-size: 30px;
      }

      /* Tweaks and hacks */
      .summary img {
        display: none;
      }
      table {
        margin: 0;
        padding: 0;
      }
      table th, table, td {
        vertical-align: top;
        padding: .3vw 1vw 0 0;
      }
      table th {
        font-weight: normal;
        color: #999;
        text-align: left;
      }

      p.title {
        font-size: 140%;
        font-family: 'Georgia';
        color: #000;
      }

      /* Animation */

.animated {
  animation-duration: 1s;
  animation-fill-mode: both;
}

@keyframes fadeInLeft {
  from {
    opacity: 0;
    transform: translate3d(0, 0, 0);
  }

  to {
    opacity: 1;
    transform: none;
  }
}

.fadeInLeft {
  animation-name: fadeInLeft;
}

@keyframes articleAnim {
  from {
    opacity: 0;
    transform: translate3d(0, 0, 0);
  }

  to {
    opacity: 1;
    transform: none;
  }
}

.articleAnim {
  animation-name: articleAnim;
}

.keyword {
  color: red;
}


    </style>
  </head>
  <body>

<!--    <div class="background-image"></div>-->

    <div class="container">
        <header>
          <div class="logo">
            <img src="UiO_MN_Seal_C_ENG_cmyk.png">
          </div>
          <div class="header">
<!--            <h1>Upcoming public PhD defences</h1>-->
          </div>
        </header>

        <main>
          
        </main>

        <footer><div>

        <span style="float:left">PhD dissertation announcements</span>

          <span id="cardno">Loading...</span>
        <!--Background: CC-BY-SA 3.0 Â© Jonathan Zander--></div></footer>

    </div>

    <!-- borrowed stuff -->
    <script src="https://cdn.rawgit.com/richardkazuomiller/feednami-client/master/releases/1.0.2.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<!--    <script type="text/javascript" src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.min.js"></script>-->

    <!-- our own js -->
    <script>
      'use strict';


      /* https://github.com/azer/relative-date/ */

      var relativeDate = (function(undefined){

        var SECOND = 1000,
            MINUTE = 60 * SECOND,
            HOUR = 60 * MINUTE,
            DAY = 24 * HOUR,
            WEEK = 7 * DAY,
            YEAR = DAY * 365,
            MONTH = YEAR / 12;

        var midnight = new Date();
        midnight.setHours(0);
        midnight.setMinutes(0);
        midnight.setSeconds(0);
        midnight.setMilliseconds(0);
        midnight = midnight.getTime();
        midnight += DAY;

        var formats = [
            [midnight, 'i dag', DAY],
            [midnight + DAY, 'Tomorrow', DAY],
            [Number.MAX_VALUE, 'In %d days', DAY],
          ];

        function relativeDate(input){
          input instanceof Date && ( input = input.getTime() );

          var delta = input - midnight,
              format, i, len;

          for(i = -1, len=formats.length; ++i < len; ){
            format = formats[i];
            if(input < format[0]){
              return format[1].replace('%d', Math.round(delta/format[2]));
            }
          };
        }

        return relativeDate;

      })();


      function stripHTML(dirtyString) {
        var container = document.createElement('div');
        var text = document.createTextNode(dirtyString);
        container.appendChild(text);
        return container.innerHTML; // innerHTML will be a xss safe string
      }

      function loadEntries(url, $h1, $main) {
        feednami.load(url, res => {
          const entries = res.feed.entries;

          var currentlyShowing = 0;

          //var entry = entries[4];

          entries.forEach(entry => {
            if(entry.title.indexOf('PR:') == -1 ){

              //console.log(entry);
              //console.log('sum', entry.summary);

              // const summary = document.createElement('div');
              // summary.innerHTML = entry.summary;
              // summary.className = 'summary';

              var dt = new Date(entry['v:event-start']['#']);

              var dtstr = dt.toLocaleDateString('nb-NO', {
                  day : 'numeric',
                  month : 'long',
                  year : 'numeric',
              }) + ', ' + dt.toLocaleTimeString('nb-NO', {
                  hour : '2-digit',
                  minute : '2-digit',
              });


              // var whitelist = "strong"; // for more tags use the multiple selector, e.g. "p, img"
              // var $summary = $(entry['summary']);
              // $summary.not(whitelist).each(function() {
              //     var content = $(this).contents();
              //     $(this).replaceWith(content);
              // });

              var summary = entry['summary'].replace(/(<([^>]+)>)/ig,"").trim();

              if (summary.indexOf(':') != -1) {
                var summarysplit = [
                  summary.substr(0, summary.indexOf(':')).replace(/["\s]+$/, '').replace(/^["\s]+/, ''),
                  summary.substr(summary.indexOf(':') + 1).replace(/["\s]+$/, '').replace(/^["\s]+/, ''),
                ];
              } else {
                var summarysplit = [summary, ''];
              }

              console.log(summarysplit);

              var view = {
                image: entry['v:image']['#'],
                title: entry['title'].replace(/D[a-z]+: /, ''),
                location: entry['v:event-location']['#'],
                start_time: dtstr,
                relative_time: relativeDate(dt),
                summary: summarysplit[0],
                summary2: summarysplit[1],
              };

              var leftCol = $('<div class="leftCol">')
                .append($('<div style="background-image: url(' + view.image + ');" class="animated fadeInLeft"></div>'))
                ;

              var rightCol = $('<div class="rightCol animated articleAnim"><div class="inner">' // <div class="article">
                  + '<h2>' + view.title + '</h2>'
                  + '<div class="intro">' + view.summary + ':</div>'
                  + '<p class="title">' + view.summary2 + '</p>' // </div>
                  + '<div class="timeloc"><table>'
                  + '<tr><th class="keyword">When</th><td class="time">' + view.start_time + '</td></tr>'
                  + '<tr><th class="keyword">Where</th><td class="loc">' + view.location + '</td></tr>'
                  + '</table></div>'
                  + '</div>'
                  );

              var entry = $('<div class="entry">')
                .append(leftCol)
                .append(rightCol)
                ;

              $main.append(entry);
            }
          });

          showCard(0);


function showCard(n) {
  $('#cardno').html((n+1) + ' / ' + entries.length)
  currentlyShowing = n;
  for (var i = entries.length - 1; i >= 0; i--) {
    if (i == currentlyShowing) {
      $($('.entry')[i]).show();
    } else {
      $($('.entry')[i]).hide();
    }
  }
}

function nextCard() {
    showCard(currentlyShowing > entries.length - 2 ? 0 : currentlyShowing + 1);
}
function prevCard() {
    showCard(currentlyShowing == 0 ? entries.length - 1 : 0);
}

$(window).keydown(function (e) {
  if (e.keyCode === 0 || e.keyCode === 32 || e.keyCode === 39 || e.keyCode === 40) {
    e.preventDefault();
    nextCard();
  }
  if (e.keyCode === 37 || e.keyCode === 38) {
    e.preventDefault();
    prevCard();
  }
});

function tick() {
    nextCard();
    setTimeout(tick, 8000);
}

setTimeout(tick);

        });
      };

      loadEntries('http://www.mn.uio.no/forskning/aktuelt/arrangementer/disputaser/?vrtx=feed&view=allupcoming', $('h1'), $('main'))
    </script>
  </body>
</html>

